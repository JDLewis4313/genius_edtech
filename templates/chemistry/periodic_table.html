{% extends 'base.html' %}
{% load static %}
{% block title %}Interactive Periodic Table - GeNiUS EdTech{% endblock %}

{% block extra_css %}
<style>
    /* Periodic Table Container */
    .periodic-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Periodic Table Grid */
    .periodic-table {
        display: grid;
        grid-template-columns: repeat(18, 1fr);
        gap: 2px;
        margin: 20px 0;
        position: relative;
    }
    
    /* Element Styling */
    .element {
        aspect-ratio: 1;
        border: 1px solid rgba(255,255,255,0.1);
        padding: 2px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-radius: 4px;
        background: rgba(26, 31, 58, 0.8);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }
    
    .element:hover {
        transform: scale(1.15);
        z-index: 10;
        box-shadow: 0 0 20px rgba(0, 184, 148, 0.5);
        border-color: var(--u-green);
    }
    
    .element.highlighted {
        animation: pulse 1s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    .atomic-number { 
        font-size: 10px;
        color: var(--text-secondary);
        line-height: 1;
    }
    
    .symbol { 
        font-size: 20px; 
        font-weight: bold;
        margin: 2px 0;
        color: var(--text-primary);
    }
    
    .name { 
        font-size: 9px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 100%;
        color: var(--text-secondary);
    }
    
    .mass { 
        font-size: 8px;
        color: var(--text-muted);
    }
    
    /* Element Categories with GeNiUS color scheme */
    .alkali-metal { 
        background: linear-gradient(135deg, rgba(255, 94, 98, 0.2), rgba(255, 94, 98, 0.1));
        border-color: rgba(255, 94, 98, 0.3);
    }
    .alkaline-earth { 
        background: linear-gradient(135deg, rgba(255, 206, 84, 0.2), rgba(255, 206, 84, 0.1));
        border-color: rgba(255, 206, 84, 0.3);
    }
    .transition-metal { 
        background: linear-gradient(135deg, rgba(255, 154, 0, 0.2), rgba(255, 154, 0, 0.1));
        border-color: rgba(255, 154, 0, 0.3);
    }
    .post-transition { 
        background: linear-gradient(135deg, rgba(0, 184, 148, 0.2), rgba(0, 184, 148, 0.1));
        border-color: rgba(0, 184, 148, 0.3);
    }
    .metalloid { 
        background: linear-gradient(135deg, rgba(0, 163, 191, 0.2), rgba(0, 163, 191, 0.1));
        border-color: rgba(0, 163, 191, 0.3);
    }
    .nonmetal { 
        background: linear-gradient(135deg, rgba(89, 151, 255, 0.2), rgba(89, 151, 255, 0.1));
        border-color: rgba(89, 151, 255, 0.3);
    }
    .halogen { 
        background: linear-gradient(135deg, rgba(155, 89, 255, 0.2), rgba(155, 89, 255, 0.1));
        border-color: rgba(155, 89, 255, 0.3);
    }
    .noble-gas { 
        background: linear-gradient(135deg, rgba(255, 89, 205, 0.2), rgba(255, 89, 205, 0.1));
        border-color: rgba(255, 89, 205, 0.3);
    }
    .lanthanide { 
        background: linear-gradient(135deg, rgba(255, 138, 138, 0.2), rgba(255, 138, 138, 0.1));
        border-color: rgba(255, 138, 138, 0.3);
    }
    .actinide { 
        background: linear-gradient(135deg, rgba(255, 177, 138, 0.2), rgba(255, 177, 138, 0.1));
        border-color: rgba(255, 177, 138, 0.3);
    }

    /* Grid positioning for specific elements */
    .period-1 { grid-row: 1; }
    .period-2 { grid-row: 2; }
    .period-3 { grid-row: 3; }
    .period-4 { grid-row: 4; }
    .period-5 { grid-row: 5; }
    .period-6 { grid-row: 6; }
    .period-7 { grid-row: 7; }
    .period-8 { grid-row: 9; } /* Lanthanides */
    .period-9 { grid-row: 10; } /* Actinides */
    
    .group-1 { grid-column: 1; }
    .group-2 { grid-column: 2; }
    .group-3 { grid-column: 3; }
    .group-4 { grid-column: 4; }
    .group-5 { grid-column: 5; }
    .group-6 { grid-column: 6; }
    .group-7 { grid-column: 7; }
    .group-8 { grid-column: 8; }
    .group-9 { grid-column: 9; }
    .group-10 { grid-column: 10; }
    .group-11 { grid-column: 11; }
    .group-12 { grid-column: 12; }
    .group-13 { grid-column: 13; }
    .group-14 { grid-column: 14; }
    .group-15 { grid-column: 15; }
    .group-16 { grid-column: 16; }
    .group-17 { grid-column: 17; }
    .group-18 { grid-column: 18; }

    /* Special positioning */
    .lanthanide-actinide-break {
        grid-column: 1 / -1;
        height: 10px;
        grid-row: 8;
    }

    /* Legend */
    .legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 10px;
        margin: 20px 0;
        padding: 20px;
        background: var(--bg-card);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .legend-item {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(26, 31, 58, 0.5);
        border: 1px solid rgba(255,255,255,0.05);
    }

    .legend-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 184, 148, 0.2);
    }

    .legend-item.active {
        background: rgba(0, 184, 148, 0.2);
        border-color: var(--u-green);
    }

    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        margin-right: 10px;
    }

    /* Search and Controls */
    .controls {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
        justify-content: center;
    }

    .search-input {
        flex: 1;
        max-width: 300px;
        padding: 10px 20px;
        border-radius: 25px;
        border: 1px solid rgba(255,255,255,0.1);
        background: var(--bg-secondary);
        color: var(--text-primary);
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--u-green);
        box-shadow: 0 0 15px rgba(0, 184, 148, 0.3);
    }

    /* Modal Styling */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background: var(--bg-card);
        backdrop-filter: blur(20px);
        margin: 3% auto;
        padding: 30px;
        width: 90%;
        max-width: 600px;
        border-radius: 20px;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255,255,255,0.1);
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .close {
        position: absolute;
        right: 20px;
        top: 20px;
        cursor: pointer;
        font-size: 28px;
        color: var(--text-muted);
        transition: color 0.3s ease;
    }

    .close:hover {
        color: var(--er-pink);
    }

    /* Element Details */
    .element-details {
        text-align: left;
    }

    .element-header {
        display: flex;
        align-items: center;
        gap: 30px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .element-symbol-large {
        font-size: 72px;
        font-weight: bold;
        color: var(--u-green);
        line-height: 1;
    }

    .element-info {
        flex: 1;
    }

    .element-name-large {
        font-size: 32px;
        margin-bottom: 5px;
        color: var(--text-primary);
    }

    .element-number-large {
        font-size: 18px;
        color: var(--text-secondary);
    }

    .property-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .property-item {
        padding: 15px;
        background: rgba(26, 31, 58, 0.5);
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.05);
    }

    .property-label {
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 5px;
    }

    .property-value {
        font-size: 16px;
        color: var(--text-primary);
        font-weight: 500;
    }

    /* Quiz Styling */
    .quiz-question {
        font-size: 20px;
        margin: 20px 0;
        color: var(--text-primary);
    }

    .quiz-options {
        display: grid;
        gap: 10px;
        margin: 20px 0;
    }

    .quiz-option {
        padding: 15px 20px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.1);
        background: var(--bg-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
    }

    .quiz-option:hover:not(.disabled) {
        background: rgba(0, 184, 148, 0.1);
        border-color: var(--u-green);
        transform: translateX(5px);
    }

    .quiz-option.correct {
        background: rgba(0, 184, 148, 0.2);
        border-color: var(--u-green);
        color: var(--u-green);
    }

    .quiz-option.incorrect {
        background: rgba(225, 112, 85, 0.2);
        border-color: var(--er-pink);
        color: var(--er-pink);
    }

    .quiz-option.disabled {
        cursor: not-allowed;
        opacity: 0.7;
    }

    .quiz-feedback {
        margin: 20px 0;
        padding: 15px;
        border-radius: 10px;
        background: rgba(26, 31, 58, 0.5);
        border: 1px solid rgba(255,255,255,0.1);
    }

    .quiz-score {
        text-align: center;
        font-size: 18px;
        margin: 20px 0;
        color: var(--text-primary);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .periodic-table {
            font-size: 90%;
            gap: 1px;
        }
        .symbol { font-size: 18px; }
    }

    @media (max-width: 768px) {
        .periodic-table {
            font-size: 70%;
            overflow-x: auto;
            min-width: 800px;
        }
        .element { padding: 1px; }
        .symbol { font-size: 14px; }
        .name { display: none; }
        .mass { display: none; }
        .controls { flex-direction: column; }
        .search-input { max-width: 100%; }
    }
</style>
{% endblock %}

{% block content %}
<div class="periodic-container fade-in">
    <div class="text-center mb-5">
        <h1 class="text-gradient mb-3">
            <i class="fas fa-atom"></i> Interactive Periodic Table
        </h1>
        <p style="color: var(--text-secondary);">Explore the elements and test your chemistry knowledge</p>
    </div>
    
    <div class="controls">
        <input type="text" class="search-input" placeholder="Search elements..." id="searchInput">
        <button class="btn btn-primary" onclick="startQuiz()">
            <i class="fas fa-question-circle me-2"></i>Take Quiz
        </button>
        <button class="btn btn-secondary" onclick="resetDisplay()">
            <i class="fas fa-redo me-2"></i>Reset View
        </button>
    </div>
    
    <div class="legend" id="legend"></div>
    
    <div class="periodic-table" id="periodicTable"></div>
    
    <div class="lanthanide-actinide-break"></div>
</div>

<!-- Element Details Modal -->
<div id="elementModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('elementModal')">&times;</span>
        <div id="elementDetails" class="element-details"></div>
    </div>
</div>

<!-- Quiz Modal -->
<div id="quizModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('quizModal')">&times;</span>
        <h2 class="text-gradient mb-4">
            <i class="fas fa-flask"></i> Periodic Table Quiz
        </h2>
        <div id="quizScore" class="quiz-score"></div>
        <div id="quizQuestion" class="quiz-question"></div>
        <div id="quizOptions" class="quiz-options"></div>
        <div id="quizFeedback" class="quiz-feedback" style="display: none;"></div>
        <button class="btn btn-primary mt-3" id="nextButton" style="display: none;" onclick="nextQuestion()">
            Next Question <i class="fas fa-arrow-right ms-2"></i>
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Element data from Django
const elements = {{ elements_json|safe }};

// Quiz questions from Django (or fallback)
let quizQuestions = {{ quiz_questions_json|safe }};

// Fallback quiz questions if none from database
if (!quizQuestions || quizQuestions.length === 0) {
    quizQuestions = [
        {
            question: "Which element has the highest atomic number?",
            options: ["Uranium", "Oganesson", "Plutonium", "Fermium"],
            correct: "Oganesson",
            explanation: "Oganesson (Og) has atomic number 118, the highest on the periodic table.",
            difficulty: "medium"
        },
        {
            question: "Which element is a liquid at room temperature?",
            options: ["Mercury", "Gallium", "Cesium", "Francium"],
            correct: "Mercury",
            explanation: "Mercury (Hg) and Bromine (Br) are the only elements liquid at room temperature.",
            difficulty: "easy"
        },
        {
            question: "What is the most abundant element in the universe?",
            options: ["Oxygen", "Carbon", "Hydrogen", "Helium"],
            correct: "Hydrogen",
            explanation: "Hydrogen makes up about 75% of the universe's elemental mass.",
            difficulty: "easy"
        },
        {
            question: "Which noble gas has the highest boiling point?",
            options: ["Xenon", "Radon", "Krypton", "Argon"],
            correct: "Radon",
            explanation: "Radon has the highest boiling point among noble gases at -61.7¬∞C.",
            difficulty: "hard"
        },
        {
            question: "Which element was named after Albert Einstein?",
            options: ["Einsteinium", "Nobelium", "Fermium", "Curium"],
            correct: "Einsteinium",
            explanation: "Einsteinium (Es, atomic number 99) was named in honor of Albert Einstein.",
            difficulty: "medium"
        }
    ];
}

// Categories for legend
const categories = [
    { id: 'alkali-metal', name: 'Alkali Metals', color: '#FF5E62' },
    { id: 'alkaline-earth', name: 'Alkaline Earth Metals', color: '#FFCE54' },
    { id: 'transition-metal', name: 'Transition Metals', color: '#FF9A00' },
    { id: 'post-transition', name: 'Post-transition Metals', color: '#00B894' },
    { id: 'metalloid', name: 'Metalloids', color: '#00A3BF' },
    { id: 'nonmetal', name: 'Nonmetals', color: '#5997FF' },
    { id: 'halogen', name: 'Halogens', color: '#9B59FF' },
    { id: 'noble-gas', name: 'Noble Gases', color: '#FF59CD' },
    { id: 'lanthanide', name: 'Lanthanides', color: '#FF8A8A' },
    { id: 'actinide', name: 'Actinides', color: '#FFB18A' }
];

// State variables
let currentQuestion = 0;
let score = 0;
let questionAnswered = false;
let activeCategory = null;

// Initialize periodic table
function createPeriodicTable() {
    const table = document.getElementById('periodicTable');
    table.innerHTML = '';
    
    elements.forEach(element => {
        const elementDiv = document.createElement('div');
        elementDiv.className = `element ${element.category} period-${element.period} group-${element.group || ''}`;
        elementDiv.dataset.element = JSON.stringify(element);
        
        // Special positioning for lanthanides and actinides
        if (element.number >= 57 && element.number <= 71) {
            elementDiv.className += ' period-8';
            elementDiv.style.gridColumn = element.number - 54;
        } else if (element.number >= 89 && element.number <= 103) {
            elementDiv.className += ' period-9';
            elementDiv.style.gridColumn = element.number - 86;
        }
        
        elementDiv.innerHTML = `
            <div class="atomic-number">${element.number}</div>
            <div class="symbol">${element.symbol}</div>
            <div class="name">${element.name}</div>
            <div class="mass">${element.mass}</div>
        `;
        
        elementDiv.onclick = () => showElementDetails(element);
        table.appendChild(elementDiv);
    });
}

// Create legend
function createLegend() {
    const legend = document.getElementById('legend');
    legend.innerHTML = '';
    
    categories.forEach(category => {
        const count = elements.filter(e => e.category === category.id).length;
        const item = document.createElement('div');
        item.className = 'legend-item';
        item.dataset.category = category.id;
        
        item.innerHTML = `
            <div class="legend-color" style="background: ${category.color}"></div>
            <div>
                <div style="font-weight: 600">${category.name}</div>
                <div style="font-size: 12px; color: var(--text-secondary)">${count} elements</div>
            </div>
        `;
        
        item.onclick = () => filterByCategory(category.id);
        legend.appendChild(item);
    });
}

// Filter by category
function filterByCategory(categoryId) {
    const allElements = document.querySelectorAll('.element');
    const legendItems = document.querySelectorAll('.legend-item');
    
    if (activeCategory === categoryId) {
        // Deactivate filter
        activeCategory = null;
        allElements.forEach(el => {
            el.style.opacity = '1';
            el.classList.remove('highlighted');
        });
        legendItems.forEach(item => item.classList.remove('active'));
    } else {
        // Activate filter
        activeCategory = categoryId;
        allElements.forEach(el => {
            if (el.classList.contains(categoryId)) {
                el.style.opacity = '1';
                el.classList.add('highlighted');
            } else {
                el.style.opacity = '0.2';
                el.classList.remove('highlighted');
            }
        });
        legendItems.forEach(item => {
            if (item.dataset.category === categoryId) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }
}

// Show element details
function showElementDetails(element) {
    const modal = document.getElementById('elementModal');
    const details = document.getElementById('elementDetails');
    
    details.innerHTML = `
        <div class="element-header">
            <div class="element-symbol-large ${element.category}">${element.symbol}</div>
            <div class="element-info">
                <div class="element-name-large">${element.name}</div>
                <div class="element-number-large">Atomic Number: ${element.number}</div>
                <div style="color: var(--text-secondary)">Atomic Mass: ${element.mass}</div>
            </div>
        </div>
        
        <div class="property-grid">
            <div class="property-item">
                <div class="property-label">Category</div>
                <div class="property-value">${getCategoryName(element.category)}</div>
            </div>
            <div class="property-item">
                <div class="property-label">Period</div>
                <div class="property-value">${element.period}</div>
            </div>
            <div class="property-item">
                <div class="property-label">Group</div>
                <div class="property-value">${element.group || 'N/A'}</div>
            </div>
            <div class="property-item">
                <div class="property-label">Phase at STP</div>
                <div class="property-value">${element.phase ? element.phase.charAt(0).toUpperCase() + element.phase.slice(1) : 'N/A'}</div>
            </div>
            ${element.electronegativity ? `
            <div class="property-item">
                <div class="property-label">Electronegativity</div>
                <div class="property-value">${element.electronegativity}</div>
            </div>
            ` : ''}
            ${element.density ? `
            <div class="property-item">
                <div class="property-label">Density</div>
                <div class="property-value">${element.density} g/cm¬≥</div>
            </div>
            ` : ''}
            ${element.meltingPoint ? `
            <div class="property-item">
                <div class="property-label">Melting Point</div>
                <div class="property-value">${element.meltingPoint} K</div>
            </div>
            ` : ''}
            ${element.boilingPoint ? `
            <div class="property-item">
                <div class="property-label">Boiling Point</div>
                <div class="property-value">${element.boilingPoint} K</div>
            </div>
            ` : ''}
            ${element.discoverer ? `
            <div class="property-item">
                <div class="property-label">Discovered By</div>
                <div class="property-value">${element.discoverer} ${element.year ? `(${element.year})` : ''}</div>
            </div>
            ` : ''}
            ${element.electronConfig ? `
            <div class="property-item" style="grid-column: 1 / -1">
                <div class="property-label">Electron Configuration</div>
                <div class="property-value">${element.electronConfig}</div>
            </div>
            ` : ''}
            ${element.radioactive ? `
            <div class="property-item">
                <div class="property-label">Radioactive</div>
                <div class="property-value">Yes‚ò¢Ô∏è</div>
            </div>
            ` : ''}
        </div>
    `;
    
    modal.style.display = 'block';
}

// Get category name
function getCategoryName(categoryId) {
    const category = categories.find(c => c.id === categoryId);
    return category ? category.name : categoryId;
}

// Search functionality
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const allElements = document.querySelectorAll('.element');
        
        if (query === '') {
            resetDisplay();
            return;
        }
        
        allElements.forEach(el => {
            const elementData = JSON.parse(el.dataset.element);
            const matches = 
                elementData.name.toLowerCase().includes(query) ||
                elementData.symbol.toLowerCase().includes(query) ||
                elementData.number.toString().includes(query);
            
            if (matches) {
                el.style.opacity = '1';
                el.classList.add('highlighted');
            } else {
                el.style.opacity = '0.2';
                el.classList.remove('highlighted');
            }
        });
    });
}

// Quiz functionality
function startQuiz() {
    currentQuestion = 0;
    score = 0;
    shuffleArray(quizQuestions);
    showQuestion();
    document.getElementById('quizModal').style.display = 'block';
}

function showQuestion() {
    if (currentQuestion >= quizQuestions.length || currentQuestion >= 10) {
        showQuizResults();
        return;
    }
    
    const question = quizQuestions[currentQuestion];
    questionAnswered = false;
    
    document.getElementById('quizScore').innerHTML = `
        Question ${currentQuestion + 1} of ${Math.min(10, quizQuestions.length)} 
        <span style="float: right">Score: ${score}</span>
    `;
    
    document.getElementById('quizQuestion').innerHTML = question.question;
    
    const optionsDiv = document.getElementById('quizOptions');
    optionsDiv.innerHTML = '';
    
    const shuffledOptions = [...question.options];
    shuffleArray(shuffledOptions);
    
    shuffledOptions.forEach(option => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'quiz-option';
        optionDiv.textContent = option;
        optionDiv.onclick = () => checkAnswer(option, question);
        optionsDiv.appendChild(optionDiv);
    });
    
    document.getElementById('quizFeedback').style.display = 'none';
    document.getElementById('nextButton').style.display = 'none';
}

function checkAnswer(selected, question) {
    if (questionAnswered) return;
    
    questionAnswered = true;
    const options = document.querySelectorAll('.quiz-option');
    
    options.forEach(option => {
        option.classList.add('disabled');
        if (option.textContent === question.correct) {
            option.classList.add('correct');
        } else if (option.textContent === selected) {
            option.classList.add('incorrect');
        }
    });
    
    const feedback = document.getElementById('quizFeedback');
    if (selected === question.correct) {
        score++;
        feedback.innerHTML = `
            <div style="color: var(--u-green)">
                <i class="fas fa-check-circle"></i> Correct!
            </div>
            <div style="margin-top: 10px">${question.explanation}</div>
        `;
    } else {
        feedback.innerHTML = `
            <div style="color: var(--er-pink)">
                <i class="fas fa-times-circle"></i> Incorrect
            </div>
            <div style="margin-top: 10px">The correct answer is: <strong>${question.correct}</strong></div>
            <div style="margin-top: 10px">${question.explanation}</div>
        `;
    }
    
    feedback.style.display = 'block';
    document.getElementById('nextButton').style.display = 'inline-block';
}

function nextQuestion() {
    currentQuestion++;
    showQuestion();
}

function showQuizResults() {
    const percentage = (score / Math.min(10, quizQuestions.length)) * 100;
    const modal = document.getElementById('quizModal');
    
    modal.querySelector('.modal-content').innerHTML = `
        <span class="close" onclick="closeModal('quizModal')">&times;</span>
        <div class="text-center">
            <h2 class="text-gradient mb-4">Quiz Complete!</h2>
            <div style="font-size: 48px; margin: 20px 0">
                ${percentage >= 80 ? 'üèÜ' : percentage >= 60 ? '‚≠ê' : 'üí™'}
            </div>
            <h3>Your Score: ${score} / ${Math.min(10, quizQuestions.length)}</h3>
            <p style="font-size: 24px; color: var(--text-secondary)">${percentage}%</p>
            <div style="margin: 30px 0">
                ${percentage >= 80 ? 'Excellent work! You really know your periodic table!' :
                  percentage >= 60 ? 'Good job! Keep studying to improve further!' :
                  'Keep practicing! The periodic table has many secrets to discover!'}
            </div>
            <button class="btn btn-primary" onclick="closeModal('quizModal')">
                Close
            </button>
            <button class="btn btn-secondary" onclick="startQuiz()">
                Try Again
            </button>
        </div>
    `;
}

// Utility functions
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function resetDisplay() {
    const allElements = document.querySelectorAll('.element');
    const legendItems = document.querySelectorAll('.legend-item');
    
    activeCategory = null;
    allElements.forEach(el => {
        el.style.opacity = '1';
        el.classList.remove('highlighted');
    });
    legendItems.forEach(item => item.classList.remove('active'));
    document.getElementById('searchInput').value = '';
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    createPeriodicTable();
    createLegend();
    setupSearch();
    
    // Close modal when clicking outside
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    }
});
</script>
{% endblock %}