<!-- templates/blog/external_detail.html -->
{% extends "core/base.html" %}
{% load blog_extras %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <article class="bg-dark text-white p-5 rounded shadow">
    <h1 class="mb-3 text-gradient">{{ article.title }}</h1>
    <p class="text-muted small">
      Published on {{ article.published_date|date:"F d, Y" }}
      <span class="badge bg-info">External</span>
      {% if article.complexity_level %}
        <span class="badge bg-secondary">{{ article.get_complexity_level_display }}</span>
      {% endif %}
      {% if article.reading_time_minutes %}
        <span class="badge bg-primary">{{ article.reading_time_minutes }} min read</span>
      {% endif %}
    </p>
    <hr class="border-secondary mb-4">
    
    <div class="fs-5">{{ article.summary }}</div>
    
    {% if has_full_content %}
      <div class="mt-4">
        <h5>Full Content:</h5>
        <div class="fs-6">{{ article.full_content|truncatewords:500 }}</div>
      </div>
    {% endif %}
    
    {% if article.featured_image %}
      <div class="mt-3">
        <img src="{{ article.featured_image }}" alt="{{ article.title }}" class="img-fluid rounded">
      </div>
    {% endif %}
  </article>

  <!-- Reactions Section -->
  {% if user.is_authenticated %}
    <div class="mt-4 p-3 bg-dark rounded">
      <h5 class="text-white mb-3">Your Reaction</h5>
      <form method="post" class="d-inline">
        {% csrf_token %}
        {% for value, emoji in REACTION_CHOICES %}
          <button type="submit" name="reaction" value="{{ value }}" 
                  class="btn btn-outline-light me-2 mb-2 {% if user_reaction == value %}btn-warning{% endif %}">
            {{ emoji }} 
            {% if reaction_count|get_item:value %}
              {{ reaction_count|get_item:value }}
            {% endif %}
          </button>
        {% endfor %}
      </form>
    </div>
  {% endif %}

  <!-- Comments Section -->
  <div class="mt-4 p-3 bg-dark rounded">
    <h5 class="text-white mb-3">Comments ({{ comments.count }})</h5>
    
    {% if user.is_authenticated %}
      <form method="post" class="mb-4">
        {% csrf_token %}
        <div class="mb-3">
          <textarea name="content" class="form-control bg-secondary text-white border-0" rows="3" 
                   placeholder="Add your comment..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Add Comment</button>
      </form>
    {% endif %}
    
    {% for comment in comments %}
      <div class="border-bottom border-secondary pb-3 mb-3">
        <div class="d-flex justify-content-between">
          <strong class="text-warning">{{ comment.user.get_full_name|default:comment.user.username }}</strong>
          <small class="text-muted">{{ comment.created_at|date:"M d, Y g:i A" }}</small>
        </div>
        <p class="mt-2 text-white">{{ comment.content }}</p>
      </div>
    {% empty %}
      <p class="text-muted">No comments yet. Be the first to comment!</p>
    {% endfor %}
  </div>

  <!-- Action Buttons -->
  <div class="mt-4 d-flex gap-2 flex-wrap">
    {% if user.is_authenticated %}
      <a href="{% url 'blog:take_external_to_commons' article.id %}" class="btn btn-warning">
        ðŸ’¬ Take it to The Commons
      </a>
    {% endif %}
    
    <a href="{{ article.original_url }}" class="btn btn-outline-info" target="_blank">
      ðŸ“– Read full article on original site
    </a>
    
    <a href="{% url 'blog:index' %}" class="btn btn-secondary">
      &larr; Back to The Feed
    </a>
  </div>
</div>
{% endblock %}